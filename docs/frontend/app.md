# ä¸»çª—å£ç¼–æ’ï¼ˆApp.tsx + ScreenshotApp.tsxï¼‰

## æ¦‚è¿°

å‰ç«¯æ ¸å¿ƒç¼–æ’å±‚ã€‚`App.tsx` æ˜¯ä¸»çª—å£çš„æ ¹ç»„ä»¶ï¼Œè´Ÿè´£ç›‘å¬åç«¯äº‹ä»¶ã€è·¯ç”±æ“ä½œã€ä¸²è”æˆªå›¾-OCR-ç¿»è¯‘å·¥ä½œæµã€‚`ScreenshotApp.tsx` æ˜¯æˆªå›¾è¦†ç›–å±‚çª—å£çš„æ ¹ç»„ä»¶ã€‚

## æ–‡ä»¶æ¸…å•

| æ–‡ä»¶ | èŒè´£ |
|------|------|
| `src/App.tsx` | ä¸»çª—å£æ ¹ç»„ä»¶ï¼šäº‹ä»¶ç›‘å¬ã€æ“ä½œè·¯ç”±ã€å·¥ä½œæµç¼–æ’ |
| `src/ScreenshotApp.tsx` | æˆªå›¾è¦†ç›–å±‚æ ¹ç»„ä»¶ï¼šåŒ…è£… ScreenshotOverlay |
| `src/main.tsx` | ä¸»çª—å£ React å…¥å£ï¼ˆæ¸²æŸ“ App åˆ° #rootï¼‰ |
| `src/screenshot.tsx` | è¦†ç›–å±‚ React å…¥å£ï¼ˆæ¸²æŸ“ ScreenshotApp åˆ° #rootï¼‰ |

## æ ¸å¿ƒé€»è¾‘

### App.tsx

**äº‹ä»¶ç›‘å¬ï¼ˆuseEffectï¼‰ï¼š**

| äº‹ä»¶ | å¤„ç†é€»è¾‘ |
|------|---------|
| `onFocusChanged` | å¤±ç„¦æ—¶å…³é—­ settings/debug-log å­çª—å£åéšè—ä¸»çª—å£ï¼ˆéç½®é¡¶ä¸”ç„¦ç‚¹æœªè½¬åˆ°å­çª—å£æ—¶ï¼‰ |
| `region-selected` | æ ¹æ® mode æ‰§è¡Œ OCR+ç¿»è¯‘æµç¨‹æˆ–ä»…æˆªå›¾ |
| `tray-action` | è·¯ç”±åˆ° `handleAction()` |
| `hotkey-action` | è·¯ç”±åˆ° `handleAction()` |

**`handleAction(action)` è·¯ç”±ï¼š**
- `"screenshot"` â†’ `startRegion("screenshot")`
- `"ocr_translate"` â†’ `startRegion("ocr_translate")`

**`handleAction` ä¸å†æå‰ show/focus ä¸»çª—å£** â€” ä¸»çª—å£çš„æ˜¾ç¤ºç”±è¦†ç›–å±‚å…³é—­å›è°ƒæ ¹æ® mode å†³å®šã€‚

**region-selected äº‹ä»¶å¤„ç†ï¼ˆæ ¹æ® mode åˆ†æ”¯ï¼‰ï¼š**

**screenshot æ¨¡å¼ï¼š**
1. `captureRegion(x, y, width, height)` â€” è£åˆ‡é€‰åŒºå›¾ç‰‡
2. `copyImageToClipboard(imageBase64)` â€” å¤åˆ¶åˆ°å‰ªè´´æ¿
3. ä¸»çª—å£ä¸å¼¹å‡º

**ocr_translate æ¨¡å¼ï¼š**
1. `captureRegion(x, y, width, height)` â€” è£åˆ‡é€‰åŒºå›¾ç‰‡
2. `recognizeText(imageBase64, sourceLang)` â€” OCR è¯†åˆ«
3. `setSourceText(ocrText)` â€” å¡«å…¥æºæ–‡æœ¬æ¡†
4. è‹¥æ–‡æœ¬éç©ºï¼š`translate(ocrText)` â€” LLM ç¿»è¯‘
5. ä¸»çª—å£ç”±è¦†ç›–å±‚å…³é—­å›è°ƒæ¢å¤ä½ç½® + show + focus

**UI å¸ƒå±€ï¼š**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“Œ            âœ‚ï¸  ğŸ“·  âš™ï¸      â”‚  â† TitleBarï¼šå·¦ pinï¼Œå³ä¾§åŠŸèƒ½å›¾æ ‡
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ æºæ–‡æœ¬è¾“å…¥                â”‚ â”‚  â† æºæ–‡æœ¬å¡ç‰‡ï¼ˆåœ†è§’ã€surface èƒŒæ™¯ï¼‰
â”‚ â”‚ ğŸ”Š ğŸ“‹                    â”‚ â”‚  â† ActionButtons åœ¨å¡ç‰‡å†…åº•éƒ¨
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚    è‹±è¯­ â–¼   â‡„   ä¸­æ–‡ç®€ä½“ â–¼   â”‚  â† è¯­è¨€é€‰æ‹©è¡Œï¼ˆå±…ä¸­ï¼‰
â”‚        ğŸ”² OpenAI â–¼           â”‚  â† æœåŠ¡é€‰æ‹©å™¨ï¼ˆå±…ä¸­ï¼‰
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ç¿»è¯‘ç»“æœ                  â”‚ â”‚  â† ç¿»è¯‘ç»“æœå¡ç‰‡
â”‚ â”‚ ğŸ”Š ğŸ“‹                    â”‚ â”‚  â† ActionButtons åœ¨å¡ç‰‡å†…åº•éƒ¨
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  SettingsDialog (modal)      â”‚  â† è®¾ç½®å¼¹çª—ï¼ˆæ¡ä»¶æ¸²æŸ“ï¼‰
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ“ä½œå…¥å£ï¼š**
- æ ‡é¢˜æ å›¾æ ‡æŒ‰é’®è§¦å‘ OCR ç¿»è¯‘ã€åŒºåŸŸæˆªå›¾ã€è®¾ç½®
- å…¨å±€å¿«æ·é”®å’Œæ‰˜ç›˜èœå•é€šè¿‡äº‹ä»¶ç³»ç»Ÿè§¦å‘
- Ctrl/Cmd+Enter å¿«æ·é”®è§¦å‘ç¿»è¯‘

**useEffect ä¾èµ–ï¼š** `[]` â€” åˆå§‹åŒ–æ—¶æ³¨å†Œä¸€æ¬¡äº‹ä»¶ç›‘å¬

### ScreenshotApp.tsx

- ä»…æ¸²æŸ“ `<ScreenshotOverlay />` ç»„ä»¶
- ä½œä¸º `screenshot.html` çš„ç‹¬ç«‹ React åº”ç”¨å…¥å£

### main.tsx / screenshot.tsx

- æ ‡å‡† React å…¥å£æ–‡ä»¶ï¼Œ`ReactDOM.createRoot` æ¸²æŸ“åˆ° `#root`
- å‡å¯ç”¨ `StrictMode`

## ä¾èµ–å…³ç³»

- **ä¾èµ–**ï¼š
  - `hooks/useScreenshot`ã€`hooks/useTranslation`
  - `stores/translationStore`ã€`stores/settingsStore`
  - `lib/invoke`ï¼ˆcaptureRegionã€recognizeTextã€copyImageToClipboardï¼‰
  - `components/*`ï¼ˆTitleBarã€TranslationPanelã€SettingsDialogã€ScreenshotOverlayï¼‰
- **è¢«ä¾èµ–**ï¼š`main.tsx` / `screenshot.tsx` ä½œä¸º Vite å…¥å£

## ä¿®æ”¹æŒ‡å—

- æ–°å¢æ“ä½œç±»å‹éœ€åœ¨ `handleAction` çš„ switch ä¸­æ·»åŠ åˆ†æ”¯
- æ–°å¢äº‹ä»¶ç›‘å¬éœ€åœ¨ `useEffect` ä¸­æ³¨å†Œ `listen()`ï¼Œå¹¶åœ¨ cleanup ä¸­è°ƒç”¨ unlisten
- å·¥ä½œæµä¸­çš„é”™è¯¯å¤„ç†é€šè¿‡ `setError()` åæ˜ åˆ° UI
- `useEffect` çš„ä¾èµ–æ•°ç»„ä¸º `[]`ï¼ˆåˆå§‹åŒ–æ—¶æ³¨å†Œä¸€æ¬¡äº‹ä»¶ç›‘å¬ï¼‰
- TitleBar é€šè¿‡ props å›è°ƒæ¥æ”¶æ“ä½œå‡½æ•°ï¼ˆ`onScreenshot`ã€`onOcrTranslate`ã€`onDebugLog`ã€`onSettings`ï¼‰
